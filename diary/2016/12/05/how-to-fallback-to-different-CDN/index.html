<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>How to fallback CSS file to different CDN | Coding Sunday</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="A user in UK report our site is broken. From the captured screen, it is easy to it is because CSS file fail to load. After testing using Webpage Test, I found out the machine in London fail to get the">
<meta property="og:type" content="article">
<meta property="og:title" content="How to fallback CSS file to different CDN">
<meta property="og:url" content="http://199911.github.io/diary/2016/12/05/how-to-fallback-to-different-CDN/index.html">
<meta property="og:site_name" content="Coding Sunday">
<meta property="og:description" content="A user in UK report our site is broken. From the captured screen, it is easy to it is because CSS file fail to load. After testing using Webpage Test, I found out the machine in London fail to get the">
<meta property="og:updated_time" content="2016-12-05T15:32:29.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="How to fallback CSS file to different CDN">
<meta name="twitter:description" content="A user in UK report our site is broken. From the captured screen, it is easy to it is because CSS file fail to load. After testing using Webpage Test, I found out the machine in London fail to get the">
  
    <link rel="alternate" href="/atom.xml" title="Coding Sunday" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Coding Sunday</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://199911.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-how-to-fallback-to-different-CDN" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/diary/2016/12/05/how-to-fallback-to-different-CDN/" class="article-date">
  <time datetime="2016-12-04T16:00:00.000Z" itemprop="datePublished">2016-12-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Diary/">Diary</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      How to fallback CSS file to different CDN
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>A user in UK report our site is broken. From the captured screen, it is easy to it is because CSS file fail to load. After testing using <a href="https://www.webpagetest.org/" target="_blank" rel="external">Webpage Test</a>, I found out the machine in London fail to get the CSS file from MAXCDN. After long comunication with the customer support of CDN and lots of black box remote testing, they confirmed it is some local network error. MaxCDN and I can do nothing but wait until ISP fix the network.</p>
<p>I come up an idea, can we fallback to other CDN automatically if the current one is fail?</p>
<a id="more"></a>
<h2 id="Javascript-file-detection"><a href="#Javascript-file-detection" class="headerlink" title="Javascript file detection"></a>Javascript file detection</h2><p>Actually, it is very common in Javascript files. Many dependency management tools ,like require.js and yepnope.js, have built in CDN fallback feature for javascript. <a href="http://stackoverflow.com/questions/1014203/best-way-to-use-googles-hosted-jquery-but-fall-back-to-my-hosted-library-on-go" target="_blank" rel="external">The implementation is very simple</a>. For example, <code>!!window.jQuery</code> can be used to check jQuery is loaded or not.</p>
<h2 id="CSS-file-detection-in-fallback-js"><a href="#CSS-file-detection-in-fallback-js" class="headerlink" title="CSS file detection in fallback.js"></a>CSS file detection in fallback.js</h2><p>CSS have nothing do with javascript, how can we detect the style is loaded or not? From the source code of <a href="https://github.com/dolox/fallback/blob/v1/fallback.js#L212" target="_blank" rel="external">fallback.js</a>, we can use the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/styleSheets" target="_blank" rel="external">style sheets web apis</a>. We can get every single rules in the styleSheets by javascript. In fallback.js, <code>selectorText</code> is used to detect the style sheet. Notices that it use exact string matching, for example, if you only have a rules <code>.css.is.loaded { display: none; }</code> and the checking of <code>.loaded</code> will be fail, because the value of <code>selectorText</code> is <code>.css.is.loaded</code></p>
<h2 id="Style-Sheets-API-fallback"><a href="#Style-Sheets-API-fallback" class="headerlink" title="Style Sheets API fallback"></a>Style Sheets API fallback</h2><p><a href="http://caniuse.com/#search=stylesheets" target="_blank" rel="external">IE 11 and Edge 14 still not support style sheets api</a>, the fallback.js implementation does not works. In this <a href="http://eddmann.com/posts/providing-local-js-and-css-resources-for-cdn-fallbacks/" target="_blank" rel="external">article</a>, it suggests to have a string match which the background color style: <code>$(&#39;body&#39;).css(&#39;color&#39;) !== &#39;rgb(51, 51, 51)&#39;)</code>. It looks not very reliable, as the css need to have exactly the same format as <code>rgb(DD, DD, DD)</code>, I have check a few browser and the string format is exactly the same.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://199911.github.io/diary/2016/12/05/how-to-fallback-to-different-CDN/" data-id="ciwc8ii8l0000ua65e1ljitg1" class="article-share-link">Share</a>
      
        <a href="http://199911.github.io/diary/2016/12/05/how-to-fallback-to-different-CDN/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/diary/2017/01/08/npm/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          npm
        
      </div>
    </a>
  
  
    <a href="/insight/2016/11/26/readings-11/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">文集十一</div>
    </a>
  
</nav>

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Testing -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4208803683107796"
     data-ad-slot="4489226860"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>  
  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Code/">Code</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Diary/">Diary</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Insight/">Insight</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Review/">Review</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Rust/">Rust</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/review/2017/03/18/professional-javascript-for-web-developers-3rd-edition-2/">&quot;Professional: JavaScript for Web Developers, Third Edition&quot; part 2</a>
          </li>
        
          <li>
            <a href="/review/2017/03/14/professional-javascript-for-web-developers-3rd-edition-1/">&quot;Professional: JavaScript for Web Developers, Third Edition&quot; part 1</a>
          </li>
        
          <li>
            <a href="/insight/2017/02/19/readings-13/">文集十三</a>
          </li>
        
          <li>
            <a href="/diary/2017/02/12/udemy-introduction-to-css-development/">Udemy: Introduction to CSS Development</a>
          </li>
        
          <li>
            <a href="/insight/2017/02/11/readings-12/">文集十二</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Sunday Ku<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'coding-sunday';
  
  var disqus_url = 'http://199911.github.io/diary/2016/12/05/how-to-fallback-to-different-CDN/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-74410128-2', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->




  </div>
</body>
</html>