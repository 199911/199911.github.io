<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Functional utility library is good | Coding Sunday</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="I refactor a report interface today. We have a new summary data, so i can simiplify the code on updating report cache.But we also have a new requirement, we want to show some expired data.
So I have t">
<meta property="og:type" content="article">
<meta property="og:title" content="Functional utility library is good">
<meta property="og:url" content="http://199911.github.io/diary/2016/04/18/functional-utility/index.html">
<meta property="og:site_name" content="Coding Sunday">
<meta property="og:description" content="I refactor a report interface today. We have a new summary data, so i can simiplify the code on updating report cache.But we also have a new requirement, we want to show some expired data.
So I have t">
<meta property="og:updated_time" content="2016-10-07T14:24:54.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Functional utility library is good">
<meta name="twitter:description" content="I refactor a report interface today. We have a new summary data, so i can simiplify the code on updating report cache.But we also have a new requirement, we want to show some expired data.
So I have t">
  
    <link rel="alternate" href="/atom.xml" title="Coding Sunday" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Coding Sunday</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://199911.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-functional-utility" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/diary/2016/04/18/functional-utility/" class="article-date">
  <time datetime="2016-04-18T15:01:24.000Z" itemprop="datePublished">2016-04-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Diary/">Diary</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Functional utility library is good
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I refactor a report interface today. We have a new summary data, so i can simiplify the code on updating report cache.But we also have a new requirement, we want to show some expired data.</p>
<p>So I have to:</p>
<ol>
<li>Update the new report cache workflow and structure</li>
<li>Clean up deprecated code (some old and long query)</li>
<li>Show the expired data in the report</li>
</ol>
<p>Task 1 and 2 are easy jobs, but the remote read-only database is quite slow. I speed up the develop and debug speed by using a mock input (hardcoding part of the query result instead of doing query everytime).</p>
<p>Problems comes form Task 3, the context is a little bit complicated, let me explain here.</p>
<a id="more"></a>
<p>We have 2 databases for different purpose. The first database store the current data, which serve the client. The other store the history, which is for analytic purpose.</p>
<p>Let me give an example to explain:<br>Suppose we have three item, a = { currnet data }, b = { currnet data, analytic data }, c = { analytic data }.<br>In terms of set theory, set of current data C = { a, b }, set of analytic data A = { b, c }.</p>
<p>The report was shown analytic result for current data. So I have something like this:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">for each current data:</span><br><span class="line">    for each analytic data:</span><br><span class="line">        if the data is from the same item:</span><br><span class="line">            merge them</span><br></pre></td></tr></table></figure></p>
<p>For the first version of report F, F = { a = { currnet data }, b = { currnet data, analytic data } }.</p>
<p>For the new report, we also need to show the outdated data.<br>But I made a mistake, I implement the code like this:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">for each analytic data:</span><br><span class="line">    for each current data:</span><br><span class="line">        if the data is from the same item:</span><br><span class="line">            merge them</span><br></pre></td></tr></table></figure></p>
<p>This report M = { b = { currnet data, analytic data }, c = { analytic data } }.<br>We want to show all data, data from a is missing. So I did a stupid quick patch.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">for each current data:</span><br><span class="line">    for each analytic data:</span><br><span class="line">        if the current data is not in analytic data set:</span><br><span class="line">            append to the report data</span><br></pre></td></tr></table></figure>
<p>What I am doing for the whole piece of code is<br>First patch: C merge ( C intersect A )<br>Second patch: A merge ( A intersect C )<br>Result: first patch merge second patch, showing all data { a, b, c }.</p>
<p>The code has a very low readability for the following reason:</p>
<ol>
<li>We can the see the whole scope of report data from first sight</li>
<li>We have two set of nested for-loop, which is quite complex</li>
</ol>
<p>A better solution is<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">extract item key from current data</span><br><span class="line">extract item key from analytic data</span><br><span class="line">union two set of keys</span><br><span class="line">for each key:</span><br><span class="line">    // find data and fill populate the item</span><br><span class="line">    for each current data:</span><br><span class="line">        if current data key = item key</span><br><span class="line">            merge</span><br><span class="line">    for each analytic data:</span><br><span class="line">        if analytic data key = item key</span><br><span class="line">            merge</span><br></pre></td></tr></table></figure></p>
<p>It is much more beautiful.<br>The extract key function can be reused.<br>The for-loop part can also be reused.</p>
<h1 id="Learning"><a href="#Learning" class="headerlink" title="Learning"></a>Learning</h1><ol>
<li>When doing data packing/restructuring, we should think about the data scope.</li>
<li>Set theory can be a good tool when data visualization.</li>
<li>Use functional utility function</li>
</ol>
<h1 id="Why-I-need-functional-utility-library"><a href="#Why-I-need-functional-utility-library" class="headerlink" title="Why I need functional utility library?"></a>Why I need functional utility library?</h1><p>The pseudo code above is simple, but the code in php is verbose and annoying, I do a lot data packing stuff: setting data, checking data, pack them into arrays. It is really time-consuming to write glue code. Not changeling, only<br>boring. When I realise I made a mistake, I almost have to rewrite all the code, so stupid.</p>
<h1 id="How-functional-utility-library-help-us"><a href="#How-functional-utility-library-help-us" class="headerlink" title="How functional utility library help us?"></a>How functional utility library help us?</h1><p>The library provides a large set of common and well integrated functions. It forces us to think about how to reuse the code, not writing lots of glue code. The code will be easier to read. As all function names have meaning, not a set of nameless for-loops waiting for you to interpretation.</p>
<p>Also, the code is highly modulize. This lower the cost of correcting a mistake. What you need to do is probably just copy and paste, or modifying the parameter only.</p>
<p>Therefore, I am going to introduce some functional utlity library into the repo. I find <a href="http://anahkiasen.github.io/underscore-php/" target="_blank" rel="external">underscore-php</a> looks good. I may spend some time to read the source code and learn to use it.</p>
<p>PS: The documentation page is too pink…</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://199911.github.io/diary/2016/04/18/functional-utility/" data-id="cio5y9xht00071365q5t7gxnu" class="article-share-link">Share</a>
      
        <a href="http://199911.github.io/diary/2016/04/18/functional-utility/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/diary/2016/04/23/chroot/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          What is chroot jail?
        
      </div>
    </a>
  
  
</nav>

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Testing -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4208803683107796"
     data-ad-slot="4489226860"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>  
  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Book-Review/">Book Review</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Code/">Code</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Diary/">Diary</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Insight/">Insight</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Review/">Review</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Rust/">Rust</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/book/2017/05/06/book-review-1/">讀後感一</a>
          </li>
        
          <li>
            <a href="/insight/2017/04/17/commentaries-17/">簡評十六</a>
          </li>
        
          <li>
            <a href="/insight/2017/04/17/commentaries-16/">簡評十六</a>
          </li>
        
          <li>
            <a href="/insight/2017/04/16/commentaries-15/">簡評十五</a>
          </li>
        
          <li>
            <a href="/insight/2017/03/26/commentaries-14/">簡評十四</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Sunday Ku<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'coding-sunday';
  
  var disqus_url = 'http://199911.github.io/diary/2016/04/18/functional-utility/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-74410128-2', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->




  </div>
</body>
</html>